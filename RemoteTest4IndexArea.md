<!-- TOC depthFrom:1 depthTo:6 withLinks:1 updateOnSave:1 orderedList:0 -->

- [JX项目工作流程规范（征求意见稿）](#jx项目工作流程规范征求意见稿)
	- [文档版本记录](#文档版本记录)
	- [说明](#说明)
		- [内容来源](#内容来源)
		- [总体目标](#总体目标)
		- [适用范围](#适用范围)
	- [人员职责定义](#人员职责定义)
	- [质量定义](#质量定义)
		- [Bug 等级](#bug-等级)
		- [质量等级](#质量等级)
	- [版本控制管理](#版本控制管理)
		- [概述](#概述)
		- [程序 Git（工程与代码）](#程序-git工程与代码)
			- [权限管理](#权限管理)
			- [分支定义](#分支定义)
			- [目录结构定义](#目录结构定义)
		- [策划 SVN（配置与资源）](#策划-svn配置与资源)
			- [权限管理](#权限管理)
			- [分支定义](#分支定义)
			- [目录结构定义](#目录结构定义)
	- [工作流程定义](#工作流程定义)
		- [基于分支的工作流程](#基于分支的工作流程)
		- [策划程序工作模型](#策划程序工作模型)
		- [开发期工作规范](#开发期工作规范)
		- [功能集成期工作规范](#功能集成期工作规范)
			- [集成周期定义](#集成周期定义)
			- [风险分析](#风险分析)
		- [周版本发布工作规范](#周版本发布工作规范)
		- [发布版本发布工作规范](#发布版本发布工作规范)
		- [关键时间节点](#关键时间节点)
	- [版本定义](#版本定义)
	- [遗漏问题](#遗漏问题)
	- [参考文件](#参考文件)

<!-- /TOC -->

# JX项目工作流程规范（征求意见稿）

## 文档版本记录

| 版本号 | 修订内容                         | 修订人 | 修订时间  |
|--------|----------------------------------|--------|-----------|
| 0.1    | 文档建立                         | 李迪   | 2016/11/3 |
| 0.2    | 根据细化讨论会修正一些未决的问题 | 李迪   | 2016/11/7 |



## 说明

### 内容来源

-   本文档基于 2016/11/2 的流程讨论结果整理而成，预计于 2016/11/7 在JX项目开始试运行，讨论会参与人有：@刘天、@夏文涛、@赖永聪、@李迪、@林祥宇、@李君勇
-   基于 2016/11/5 和 @赵淳洁 讨论的内容修订美术 SVN 使用的一些问题
-   基于 2016/11/7 的流程细节讨论会修订一些前一个版本未决的内容，讨论会参与人有：@刘天、@夏文涛、@万雅清、@赖永聪、@李迪、@林祥宇、@李君勇、@牛佳
-   同时本文档包含了 @万雅清 定义的部分项目规范内容

### 总体目标

设计一个
- 符合项目自身需求，
- 在保证功能开发效率并降低版本风险的前提下，
- 每周能够产出一个高质量的可用版本，
- 使集成的功能可以稳步迭代步进，
- 同时能够兼顾程序、策划不同使用习惯

的工作流程模型。

### 适用范围

- 本文档主要定义
	- 功能组成员的职责定义
	- JX 项目程序、策划与测试的工作流程以及工作规范
	- 部分涉及了与美术相关的工作交互
- 本文档不包含
	- 功能组分组安排
	- 项目需求及项目计划定义
	- 美术资源管理及工作流程

## 人员职责定义

- 功能组
	- 一般由一个策划（功能负责人）、一个客户端程序和一个服务器程序组成
	- 策划职责
		- 需求文档编写、策划文档审核、提交UE/美术需求、发起需求评审、创建 JIRA 任务
		- 制定计划与时间估算、推动功能进行、协调美术策划程序以及功能间时间点
		- 根据UE设计及美术效果图制作UI
		- 集成美术资源、填写配置
		- 制作功能测试版本
		- 主导功能验收、推动制作人审核、确保每个环节达到质量标准
	- 程序职责
		- 策划需求评审
		- 功能开发
	- 美术职责
		- 按时提交美术资源
		- 真机效果调试
	- 测试职责
		- 写 Checklist 以及 测试用例
		- 开发期功能测试
		- 集成测试
		- 周版本测试
		- 发布版本测试
		- 测试报告
	- PM职责
		- 协调所有职能的工作
		- 定义版本时间以及跟踪工作计划进度
		- JIRA 维护



## 质量定义

### Bug 等级


Bug 等级 | 描述
---------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
P0       | 功能未完成 <br> 宕机
P1       | 功能跑不通 <br> 数值错误 <br> 界面不可用 （e.g. UI与美术效果图不符、UE操作困难） <br> 明显显示问题 <br> 明显的资源问题（e.g. 资源效果与美术预期不符：镜头位置、动作速度、地图连接等）
P2       | 不影响使用的功能逻辑错误 <br> 改进功能（e.g. 增添便捷操作功能）
P3       | 建议、增加表现 （e.g. 新想法新建议、光柱动画等表现建议） <br> 经评审组审议过的难以修改的问题

### 质量等级

质量等级 | 描述
--- | ----
提交测试质量 | 无 P0 Bug 且无正向功能 Bug （完成执行测试提交的 Check list）
集成质量 | 无 P0、P1 Bug
周版本质量 | 无 P0、P1 Bug 且 P2 Bug 修正 50%
发布版本质量 | 无 P0、P1 Bug 且 P2 Bug 修正 80%

## 版本控制管理

### 概述

总体上使用 Git 与 SVN 分离模型，程序代码依然使用 Git 管理，方便分支操作；资源及配置使用 SVN 管理，在一定程度上避免资源冲突。

- 目的
	- 使资源文件脱离 Git 管理，避免 Git LFS 的问题
	- 策划可以工作在更加熟悉的 SVN 环境中
	- SVN 同分支可以 Lock
- 规范
	- 程序 Git 库**不能**包含任何资源及配置内容
	- 程序有 SVN 库的读权限，没有 SVN 库的写权限
	- 策划没有 Git 库的任何权限

注意：下面的说明可能以程序 Git 分支为主进行表述，因为主要 Workflow 以及版本以程序 Git 分支为基准进行流动，但是需要注意，策划配置及资源管理均在对应的 SVN 库中进行，不可以将资源及配置提交到 Git 库。

### 程序 Git（工程与代码）

**注意**：UnrealEngine、UnrealLua、KUMGPlugin 以及 Olympus 依然在单独的 Git 库中，一般情况下不随功能分支建立分支，并默认这些库是稳定的，不依赖特定游戏功能，不需要单独测试。

#### 权限管理
- `Feature Branch` 的所有权限由各个功能组自己控制
- 除 `Feature Branch` 外的其他分支权限由 @夏文涛 管理，并在特定的时间点对特定的功能组开放。
- 只有程序有程序 Git 的权限，其他人不可访问

#### 分支定义

分支名                         | 主要功能                                             | 说明
-------------------------------|------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Feature <br>（功能分支）       | 功能开发、策划配置、功能测试                         | 每个功能对应一个功能分支，功能完成程序开发、策划配置、测试并达到**集成质量**后，将功能集成到 `Integration Branch`，然后本功能分支关闭
Integration <br>（集成分支）   | 功能集成、集成测试、集成 Bug Fix、集成编辑器版本发布 | 分为若干[集成周期](#集成周期定义)，周期结束的游戏版本为周版本。发布版本末期周版本可能没有新功能进入，此时周版本应当只有 Bug Fix 提交。在此分支上除了要制作测试版本以外，还需要制作集成编辑版本给策划配置使用。
Pre-Release <br>（周版本分支） | 周版本测试、周版本发布、美术编辑器版本发布           | 周版本分支不进行Bug Fix，所有周版本的 Bug Fix 都要在 `Integration Branch` 完成，跟随下一个周版本发布
Release <br>（发布分支）       | 发布版本发布、 发布版本 Hot Fix                          | 最终版本发布，用作上线使用。线上急需修复的 Bug ，走 Hot Fix 流程。


#### 目录结构定义

- SwordGame
	- Build（平台相关资源）
	- Certificate（iOS证书）
	- Config（配置）
	- Content（空，使用 SVN 内容）
	- Plugin（插件代码与资源）
	- Script（Lua脚本）
	- Source
		- CMakeModules
		- Config（服务器配置）
		- LogicCore（基础模块代码）
		- NoahSDK（基础库代码）
		- Server（服务器工程及代码）
		- SwordGame（游戏C++代码）
		- SwordGameEditor
		- ThirdParty（第三方库）
		- Tools（开发工具）

### 策划 SVN（配置与资源）

#### 权限管理
- 策划 SVN 的权限由 @刘天 管理
- 只有策划有策划 SVN 的写权限，程序只有策划 SVN 的读权限

#### 分支定义


分支名                         | 主要功能                                             | 说明
-------------------------------|------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Work <br>（工作分支）          | 策划配置、美术资源集成、UI 制作                      | 用于策划提交修改的版本记录，可以用 SVN 版本号来与程序同步资源与配置，**并不保证** 文件在版本之间是继承的关系。本分支不与 `策划 Integration Branch` 同步，并且**不与程序 Feature Branch 对应**
Integration <br>（集成分支）   | 功能集成、集成测试、集成 Bug Fix、公用编辑器版本发布 | 与 `程序 Intragration Branch` 同步
Pre-Release <br>（周版本分支） | 周版本测试、周版本发布                               | 与 `程序 Pre-Release Branch` 同步
Release <br>（发布分支）       | 发布版本发布、 发布版本 Hot Fix                          | 与 `程序 Release Branch` 同步

#### 目录结构定义

- Content
	- GameContent（配置表格）
	- GameData（客户端使用导出数据）
	- Human（待删除）
	- Localization（本地化数据）
	- Map（主图及逻辑地图）
	- Meterial（待删除）
	- Resource（美术资源，动画相关配置）


## 工作流程定义


### 基于分支的工作流程

![基于分支的工作流程](Workflow.png)

说明：
- 从左向右为时间流向方向，由于工具限制，不能表现出不同分支间的同步关系，同步关系以虚线和点线表现
- 带箭头的虚线表示**集成**，一般会带有文件 Merge 操作
- 带箭头的点线表示**发布**，一般是直接集成，不存在 Merge
- 带颜色方块表示同一功能的行为，图中以Feature A、 Feature B 和 Feature C 举例
- 程序 Git 和 策划 SVN 的 Integration Branch、 Pre-Release Branch 和 Release Branch 在集成和发布时需要**保持一致**
- 图上没有表现美术 `Temp Branch` 和 `Release Branch`，美术的工作流程不变，但是与策划、程序配合的方式发生了变化，具体见 [开发期工作规范](#开发期工作规范)

概念定义
- Bug Fix: 指常规 Bug 修复，一般会包含工程设置改动、代码改动、策划配置改动以及美术资源改动等
- Hot Fix：指版本上线后的严重 Bug 修复，修改内容同 Bug Fix，但是对及时性要求较高，不能等到下一个版本发布，需要在发布分支直接修改并上线。修改内容需要反向集成到 Integration Branch。


### 策划程序工作模型

![基于分支的工作流程](Co-opModel.png)

说明
- 从左向右为时间流向方向，由于工具限制，不能表现出不同分支间的同步关系，同步关系以虚线和点线表现
- 本示意图主要为了说明策划、程序与美术间的配合方式，为了突出关键节点，省略了一些无关的节点。
- 新的工作流程引入了新的合作方式，程序**不再**直接与美术交互，所有的美术资源由策划从`美术发布 SVN` 集成进 `策划 Work SVN`。

### 开发期工作规范


- 开启新的`Feature Branch` 时，需要记录当时的 `策划 Integration Branch`版本号（图中为 Rev. Y）作为**基础资源配置版本**（图中以暗红色点画线表示），在整个功能开期间此版本不变化，所有策划配置与美术资源集成均以**此版本为基础**。程序本地也使用同一版本作为本地资源配置目录内容。
- 橙色的点线表示策划将提交到 `策划 Work Branch` 的内容提交给程序，方式是策划提供给程序提交的版本号（图中为 Rev. A,B,C），程序按照顺序依次 Checkout 并覆盖本地内容使用。
- 开发需要提供给策划可以带有新功能的编辑器版本，测试使用的版本由功能策划给出，版本说明见[版本定义](#版本定义)。
- 如果程序需要修改策划 SVN 中的 BluePrint 等逻辑内容，需要和策划协商修改方式，最终修改版本由策划提交到策划 SVN。
- 根据 @刘天 的说法，`策划 Work SVN` 有可能按照功能拆分为多个，程序需要和策划协商最终策划使用的 SVN 分支路径及使用方式。
- UI 相关的说明：
	- 策划在配置 UI 时，直接在 `美术发布 SVN` 上工作并提交（内容包括图素资源、UI、UP 资源文件等），当 UI 制作完成后，将 UI 资源统一提交到 `策划 Work SVN`，然后提交给程序使用。
	- 美术制作的 UI 图素资源、序列帧等资源，均由制作对应 UI 的策划提交。
	- 美术制作 UI 动态效果时，需要和对应的策划进行协调，避免冲突，美术需要在 `美术发布 SVN` 上工作并提交，然后交由对应策划统一提交到 `策划 Work SVN`，然后提交给程序使用。

### 功能集成期工作规范

- 功能集成时，需要程序和策划同时将需要集成的内容分别集成到 `程序 Integration Branch` 和 `策划 Integration Branch`，图中以蓝色虚线表示。
- 为了保证集成时功能间不产生干扰，同一时间只允许单个功能进行集成。
- 程序功能集成一般是将 `Feature Branch` 上最新的提交集成到 `Integration Branch`；但是策划需要将 `Work Branch` 上的所有关于本功能的提交依次 Merge（图中为 Rev. A,B,C,D）。如果策划同时在几个 Feature 工作，注意不要互相覆盖修改。
- 周版本功能集成完毕或者集成窗口关闭后，进入集成测试阶段。
- 集成期的编辑器版本与测试版本由项目组统一制作，版本说明见[版本定义](#版本定义)。
- `Integration Branch` 上面发现的 Bug，直接在分支上修复，不再走 `Feature Branch` 逻辑，如果改动较大，可以按照新功能安排开发。
- `Integration Branch` 所有的提交要求有 JIRA ID。
- 为了降低长时间开发带来的风险，建议可以走阶段集成的方式。即，在开发中期从 `Pre-release Branch` 将已经通过测试的周版本代码和资源提前集成到 `Feature Branch`。


#### 集成周期定义

- 每个集成周期为一个**自然周**，每个集成周期对应一个周版本，所以周版本计划应当与集成周期相对应
- 单个集成周期内可能有新功能集成，也可能有上一个周版本的 Bug Fix 集成，也可能有纯美术资源的集成，但是每个提交要求对应一个 JIRA ID。
- 每个集成周期前**两天**定义为**功能集成窗口**，如果计划进入集成周期的功能未能在功能集成窗口时间内达到`集成质量`，则这个功能**无法**进入本集成周期，需要等待下一个集成周期
- 时间段细化：
	- 周一～周二：功能集成窗口
	- 周三～周五：集成测试及 Bug Fix
	- 周六：周版本 及 Checklist 测试
- 功能集成时，`程序 Feature Branch` 与 `策划 Work Branch` 对应的配置和资源内容必须在**同一个时间点**同时提交到对应的 `Integration Branch`
- 对于有些已经集成的功能，如果出现严重问题导致无法在可容忍的时间内达到周版本质量，需要重置整个集成周期内的提交，重新开启新的集成周期


#### 风险分析
- 功能开发完成到达到集成质量可以提交中间间隔的时间可能会较长，有可能会导致集成时 `Integration Branch` 的变化过大。
- 由于`集成质量`与`周版本质量`差距有 50% P2 Bug，而集成期还可能有新的集成 Bug 出现，在 3 天内完成测试并达到`周版本质量`的风险较大，建议在集成前完成尽可能多的 P2 Bug Fix，否则可能会导致周版本无法按时完成。
- 策划集成配置和美术资源到 `策划 Integration Branch` 时，可能会面临较多的二进制文件 Merge，出问题的风险较大。


### 周版本发布工作规范

- `周版本`以指定的周期进行发布，完成集成测试以及 Bug Fix，并达到`周版本质量`后，即可发布。
- 发布由 @刘天 @夏文涛 @李君勇 负责，`周版本`说明见 [版本定义](#版本定义)
- 发布周版本的同时，制作`美术开发版本`
- 周版本发布后，测试应当提供这个周版本相关的测试报告。


### 发布版本发布工作规范

- `发布版本`在指定的时间发布，一般在所有功能完成后，预留若干集成周期用作 Bug Fix，完成集成测试以及 Bug Fix，并达到`发布版本质量`后，即可发布。即，`发布版本`是一个达到`发布版本质量`的`周版本`。
- 发布由 @刘天 @夏文涛 @李君勇 负责，`发布版本`说明见 [版本定义](#版本定义)

### 关键时间节点

- 开发期
	- 功能开发开始时间
	- 策划验收时间
	- 策划配置时间
	- 提交测试时间
	- 提交集成时间
- 集成期与周版本
	- 集成周期开始时间（每周一）
	- 集成测试开始时间（每周三）
	- 周版本发布时间（每周六）
- 发布版本
	- 发布时间

## 版本定义


版本名       | 目的           | 形式  | 周期 | 负责人           | 基础分支           | 存放位置        | 内容组合方式
-------------|----------------|--------|--------|------------------|--------------------|-----------------|-----------------------------------------------------------------------------------------------------------------------------------------------
功能配置版本 | 策划用功能配置 | Editor | 按需 | 功能程序         | Feature Branch     | FTP（暂定）     | 1. Engine 可执行文件<br> 2. Feature Branch 游戏可执行文件 <br> 3. Feature Branch Lua 脚本
功能测试版本 | 功能测试使用   | Editor | 按需 | 功能策划（暂定） | Feature Branch     | FTP（暂定）     | 1. `功能配置版本`内容<br> 2. Feature 对应策划 Integration Branch 内容 <br> 3. 策划 Work Branch 上 Feature 对应的配置内容
功能测试版本 | 功能测试使用   | iOS   | 按需 | 功能策划（暂定） | Feature Branch     | FTP（暂定）     | 使用 `功能测试版本` 进行 Package iOS
集成配置版本 | 集成期配置使用 | Editor | 每日 | 版本制作负责人   | Integration Branch | FTP（暂定）     | 1. Engine 可执行文件<br> 2. Integration Branch 游戏可执行文件 <br> 3. Integration Branch Lua 脚本
集成测试版本 | 集成期测试使用 | iOS   | 每日 | 版本制作负责人   | Integration Branch | InHouse（暂定） | 1. Engine 代码 <br> 2. Integration Branch 代码 <br> 3. 策划 Integration Branch 内容 <br> 4. 通过 Jekins 自动打版本
周版本       | 内部发布使用   | iOS  | 每周  | 版本制作负责人   | Pre-Release Branch | InHouse（暂定） | 1. Engine 代码 <br> 2. Pre-Release Branch 代码 <br> 3. 策划 Pre-Release Branch 内容 <br> 4. 通过 Jekins 自动打版本
美术开发版本 | 美术开发使用   | Editor | 每周 | 版本制作负责人   | Pre-Release Branch | 美术发布 SVN    | 1. Engine 可执行文件<br> 2. Pre-Release 游戏可执行文件 <br> 3. Pre-Release Lua 脚本 <br> 4. 策划 Integration Branch 内容（仅配置，无美术资源）
发布版本     | 功能测试版本   | iOS  | 按需  | 版本制作负责人   | Release Branch     | InHouse（暂定） | 1. Engine 代码 <br> 2. Release Branch 代码 <br> 3. 策划 Release Branch 内容 <br> 4. 通过 Jekins 自动打版本

说明：
- 目前`版本制作负责人`由 @殷亮 和 @张乐文 担任

## 遗漏问题
- 未定义发布后的配置修改流程以及活动配置更新流程
- 未定义本地化相关文件目录及本地化流程
- 自助配置选择版本制作工具需求以及版本发布形式需要定义
- 版本的版本号定义

## 参考文件
- JX2M流程规范
	- svn://svn.xsjme.com/xsjme-code/trunk/SwordGame/Designer/项目管理/JX2M流程规范.xlsx

